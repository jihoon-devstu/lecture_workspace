<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style type="text/css">
       #wrapper{
            height: 800px;
            width: 1200px;
            margin:auto;
        }

        #aside_regist{
            height: 100%;
            width: 200px;
            float: left;
            background-color: bisque;
        }

        #content{
            height: 100%;
            width: 800px;
            float: left;
        }

        #content_header{
            height: 50px;
            width: 100%;
            background-color: lightgreen;
            line-height:50px;
            text-align : center;
        }

        #list{
            height: 750px;
            width: 100%;
            background-color: lightpink;
        }

        #aside_detail{
            height: 100%;
            width: 200px;
            float: left;
            background-color: lightcoral;
        }

</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript">
	function getFoodList(){
		//화면 전체 X가 아니라 , 화면의 일부 영역을 바꾸기 원함... 따라서 서버로 부터 가져올 대상은 html이 아닌 데이터이다.
		//js의 실행부는 서버에 데이터를 전송하고 , 받는 능력이 없다 !! 
		//크롬과 같은 브라우저로 하여금 , 데이터를 서버에 전송하고, 서버가 응답을 할 때 데이터를 받아올 수 있도록 
		//브라우저에게 맡겨야 한다....
		//js는 java와 달리 단일 쓰레드 기반이기 때문에 , 따라서 웹 요청과 응답을 받으면서 동시에 다른 것을 할 수 있는 
		//능력이 없다. 하지만 웹 브라우저는 멀티 쓰레드 기반이기 때문에 , 웹요청 , 루프 , 시계... 등등 다 할 수 있다.
		//js가 브라우저에게 웹 요청을 비동기방식으로 맡기려면 , 순수 js에서 지원하는 객체가 있는데,
		//XMLHttpRequest
		
		let xhttp = new XMLHttpRequest(); //Ajax기술의 핵심 객체 !!!
		
		xhttp.open("GET","/foodtype/list");
		
		xhttp.onload=function(){ //웹 브라우저가 서버로부터 응답을 받았을 경우 이 메서드 호출

			//JSON.parse = 문자열을 대상으로 , 파싱하여 JSON 객체로 반환.
			console.log(JSON.parse(this.responseText));
			let list = JSON.parse(this.responseText);
		
			//JSON으로 변환한 시점부터는 화면에 렌더링 시키자.
			let tag="<option value ='0'>유형 선택</option>"
			
			for(let i = 0; i<list.length;i++){
				tag+="<option value ='"+(i+1)+"'>"+list[i].title+"</option>"
			}
			$("#aside_regist select").html(tag); //innerHTML
		}
		
		xhttp.send(); //전송이 발생하는 시점.
		
	}
	
	//비동기 방식의 post 요청
	function regist(){
		let xhttp = new XMLHttpRequest();
		xhttp.open("POST","/store/regist");
		
		//아래의 post전송 요청 헤더는 표준 , 그동안은 브라우저가 대신 해줌.
		//그러나 XMLHttpRequest 를 이용할 때는 개발자가 직접 다 해줘야함....
		xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		xhttp.onload=function(){
			 if(this.status ==201){ //status 서버의 응답 코드 / 200번대 : 긍정적 / 400,500 등 올라갈수록 에러.
				//목록 가져와 출력 하기
				alert("성공");
			} else{
				let json = JSON.parse(this.responseText); //서버가 보내온 응답 문자열
				alert(json.msg);
			}
		}
		
		let param = "food_type_id="+$("#aside_regist select").val();
		param+="&store_name="+$("#aside_regist input[name='store_name']").val();
		param+= "&tel="+$("#aside_regist input[name='tel']").val();
		
		xhttp.send(param); //이 시점부터 js는 자기 할일 하고 , 브라우저가 통신을 담당함. 즉 비동기가 시작되는 시점.
		
	}
	
	$(()=>{
		getFoodList();
		
		$("#aside_regist button").click(()=>{
			regist();
		});
	});
</script>


</head>
<body>

    <div id="wrapper">
        <div id="aside_regist">
        	<select name = "food_type_id"></select>
        	<input type="text" name = "store_name" placeholder = "맛집 상호명">
        	<input type="text" name = "tel" placeholder = "연락처">
        	<button type = "button">등록</button>
        </div>
        <div id="content">
            <div id="content_header">
            	<select>
            		<option>모두</option>
            		<option>상호명</option>
            		<option>연락처</option>
            	</select>
            	<input type="text" placeholder = "검색 키워드">
            	<button>Search</button>
            </div>
            <div id="list"></div>
        </div>
        <div id="aside_detail">
        	<select></select>
            <input type="text" placeholder = "맛집 상호명">
        	<input type="text" placeholder = "연락처">
        	<button>수정</button>
        	<button>삭제</button>
        </div>
    </div>


</body>
</html>